[gd_scene load_steps=7 format=2]

[ext_resource path="res://addons/action_command/lib/command_manager.gd" type="Script" id=1]
[ext_resource path="res://addons/action_command/demo/key.gd" type="Script" id=2]
[ext_resource path="res://addons/action_command/demo/arrow.png" type="Texture" id=3]
[ext_resource path="res://addons/action_command/demo/button.png" type="Texture" id=4]
[ext_resource path="res://addons/action_command/demo/check.png" type="Texture" id=5]

[sub_resource type="GDScript" id=1]
script/source = "extends Node2D

var _action1

func _ready():
	_action1 = $command.parse_command(\"down&!right:30,down&right,!down&right,action<:5\")


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	var command = $command
	command.tick()
	
	if command.is_press(\"right\") and command.is_press(\"down\"):
		$joystick/rightdown.modulate = Color.red
	else:
		$joystick/rightdown.modulate = Color.white
		
	if command.is_press(\"down\") and command.is_press(\"left\"):
		$joystick/downleft.modulate = Color.red
	else:
		$joystick/downleft.modulate = Color.white
		
	if command.is_press(\"left\") and command.is_press(\"up\"):
		$joystick/leftup.modulate = Color.red
	else:
		$joystick/leftup.modulate = Color.white
		
	if command.is_press(\"up\") and command.is_press(\"right\"):
		$joystick/upright.modulate = Color.red
	else:
		$joystick/upright.modulate = Color.white
	
	if $joystick/rightdown.modulate == Color.white and $joystick/upright.modulate == Color.white and command.is_press(\"right\"):
		$joystick/right.modulate = Color.red
	else:
		$joystick/right.modulate = Color.white
	
	if $joystick/leftup.modulate == Color.white and $joystick/downleft.modulate == Color.white and command.is_press(\"left\"):
		$joystick/left.modulate = Color.red
	else:
		$joystick/left.modulate = Color.white
	
	if $joystick/upright.modulate == Color.white and $joystick/leftup.modulate == Color.white and command.is_press(\"up\"):
		$joystick/up.modulate = Color.red
	else:
		$joystick/up.modulate = Color.white
	
	if $joystick/downleft.modulate == Color.white and $joystick/rightdown.modulate == Color.white and command.is_press(\"down\"):
		$joystick/down.modulate = Color.red
	else:
		$joystick/down.modulate = Color.white
	
	if command.is_press(\"action\"):
		$joystick/a.modulate = Color.red
	else:
		$joystick/a.modulate = Color.white

	var result = command.command_match(_action1)
	if result != null:
		result.use()
		_display_checkmark($action1/check)

func _display_checkmark(checkmark: Sprite):
	checkmark.visible = true
	yield(get_tree().create_timer(3), \"timeout\")
	checkmark.visible = false
	
"

[node name="Node2D" type="Node2D"]
script = SubResource( 1 )

[node name="command" type="Node" parent="."]
script = ExtResource( 1 )

[node name="up" type="Node" parent="command"]
script = ExtResource( 2 )
scancode = 16777232

[node name="down" type="Node" parent="command"]
script = ExtResource( 2 )
scancode = 16777234

[node name="left" type="Node" parent="command"]
script = ExtResource( 2 )
scancode = 16777231

[node name="right" type="Node" parent="command"]
script = ExtResource( 2 )
scancode = 16777233

[node name="action" type="Node" parent="command"]
script = ExtResource( 2 )
scancode = 32

[node name="joystick" type="Node2D" parent="."]

[node name="right" type="Sprite" parent="joystick"]
position = Vector2( 252, 148 )
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="rightdown" type="Sprite" parent="joystick"]
position = Vector2( 242, 177 )
rotation = 0.785398
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="down" type="Sprite" parent="joystick"]
position = Vector2( 211, 186 )
rotation = 1.5708
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="downleft" type="Sprite" parent="joystick"]
position = Vector2( 180, 177 )
rotation = 2.35619
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="left" type="Sprite" parent="joystick"]
position = Vector2( 169, 147 )
rotation = -3.14159
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="leftup" type="Sprite" parent="joystick"]
position = Vector2( 180, 115 )
rotation = -2.35619
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="up" type="Sprite" parent="joystick"]
position = Vector2( 213, 104 )
rotation = -1.5708
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="upright" type="Sprite" parent="joystick"]
position = Vector2( 245, 115 )
rotation = -0.785398
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="a" type="Sprite" parent="joystick"]
position = Vector2( 368, 145 )
scale = Vector2( 0.655556, 0.655556 )
texture = ExtResource( 4 )

[node name="action1" type="Node2D" parent="."]

[node name="down" type="Sprite" parent="action1"]
position = Vector2( 218, 309 )
rotation = 1.5708
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="rightdown" type="Sprite" parent="action1"]
position = Vector2( 261, 307 )
rotation = 0.785398
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="right" type="Sprite" parent="action1"]
position = Vector2( 311, 311 )
scale = Vector2( 0.477778, 0.477778 )
texture = ExtResource( 3 )

[node name="a" type="Sprite" parent="action1"]
position = Vector2( 393, 308 )
scale = Vector2( 0.655556, 0.655556 )
texture = ExtResource( 4 )

[node name="check" type="Sprite" parent="action1"]
visible = false
position = Vector2( 501, 312 )
scale = Vector2( 0.5, 0.5 )
texture = ExtResource( 5 )
